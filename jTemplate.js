!function(t){var e={};function i(n){if(e[n])return e[n].exports;var s=e[n]={exports:{},id:n,loaded:!1};return t[n].call(s.exports,s,s.exports,i),s.loaded=!0,s.exports}i.m=t,i.c=e,i.p="",i(0)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(1);e.Template=n.Template;const s=i(8);e.ObjectStore=s.ObjectStore,e.Value=s.Value;const r=i(13);e.div=r.div,e.span=r.span,e.ul=r.ul,e.li=r.li,e.input=r.input,e.b=r.b,e.a=r.a,e.br=r.br,e.img=r.img,e.video=r.video,e.source=r.source,e.option=r.option,e.select=r.select,e.h1=r.h1,e.h2=r.h2,e.h3=r.h3;const o=i(7);var a=new class{constructor(){this.todos=s.ObjectStore.Create([]);var t=new o.ObjectStoreScope(()=>this.report);t.addListener("set",()=>console.log(t.Value))}get report(){return 0===this.todos.Root.length?"<none>":`Next todo: ${this.todos.Root[0].task}. Progress: ${this.completedCount}/${this.todos.Root.length}`}get completedCount(){return this.todos.Root.filter(t=>t.completed).length}addTodo(t){this.todos.Push(this.todos.Root,{task:t,completed:!1,assignee:null})}};a.addTodo("val 1"),a.addTodo("val 2"),a.todos.Root[0].completed=!0,a.todos.Root[1].task="changed val 2",a.todos.Root[0].task="changed val 1";var l=n.Template.ToFunction("ul",class extends n.Template{Template(t){return r.li({on:()=>({dblclick:this.onRename.bind(this,t)})},()=>[r.input({props:()=>({type:"checkbox",checked:t.completed}),on:()=>({change:this.onToggleCompleted.bind(this,t)})}),r.span({text:()=>`${t.task} ${t.assignee||""}`})])}onToggleCompleted(t){t.completed=!t.completed}onRename(t){t.task=prompt("Task name",t.task)||t.task}});(new class extends n.Template{constructor(){super("todo-list")}Template(){return r.div({},()=>[r.span({text:()=>a.report}),l({data:()=>a.todos.Root}),r.input({props:()=>({type:"button",value:"New Todo"}),on:()=>({click:this.onNewTodo.bind(this)})})])}onNewTodo(){a.addTodo(prompt("Enter a new todo:"))}}).AttachTo(document.getElementById("container"))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(2),s=i(5),r=i(10),o=i(11),a=i(12);function l(t,e,i,n){return{type:t,class:e,props:i&&i.props,on:i&&i.on,data:i&&i.data,key:i&&i.key,templates:n}}function u(){return!0}e.TemplateFunction=function(t,e,i){return{type:t,props:e&&e.props,on:e&&e.on,data:e&&e.data,key:e&&e.key,text:e&&e.text,children:i}};class h{constructor(t){var e,i,h;"string"==typeof t&&(t=l(t,this.constructor)),this.templates=this.DefaultTemplates,this.SetTemplates(t.templates),t.children=t.children||this.Template.bind(this),this.bindingRoot=n.BindingConfig.createBindingTarget(t.type),this.bindings=(e=this.bindingRoot,i=[],(h=t).props&&i.push(new s.default(e,h.props)),h.on&&i.push(new a.default(e,h.on)),h.text?i.push(new o.default(e,h.text)):h.children&&(h.data=h.data||u,i.push(new r.default(e,h.data,h.children,h.key))),i)}get DefaultTemplates(){return{}}get Templates(){return this.templates}get Root(){return this.bindingRoot}SetTemplates(t){if(t)for(var e in t)this.templates[e]=t[e]}UpdateComplete(t){n.BindingConfig.updateComplete(t)}AttachTo(t){n.BindingConfig.addChild(t,this.bindingRoot)}AttachToContainer(t){n.BindingConfig.addContainerChild(t,this.bindingRoot)}AttachBefore(t,e){n.BindingConfig.addChildBefore(t,e&&e.bindingRoot,this.bindingRoot)}AttachAfter(t,e){n.BindingConfig.addChildAfter(t,e&&e.bindingRoot,this.bindingRoot)}Detach(){n.BindingConfig.remove(this.bindingRoot)}Destroy(){this.Detach(),this.bindingRoot=null,this.bindings.forEach(t=>t.Destroy()),this.bindings=[]}Template(t,e){return[]}}e.Template=h,function(t){t.ToFunction=function(t,e){return function(t,e){return l.bind(null,t,e)}(t,e)},t.Create=function(e){return new(e.class||t)(e)}}(h=e.Template||(e.Template={}))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(3);e.BindingConfig=n.DOMBindingConfig},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(4);var s=[],r=!1,o=0,a=3e3;function l(){for(var t=a+o,e=o;e<t&&e<s.length;e++,o++)s[e]();o==s.length?(o=0,s=[],r=!1):n.wndw.requestAnimationFrame(l)}e.DOMBindingConfig={scheduleUpdate:function(t){s.push(t),r||(r=!0,n.wndw.requestAnimationFrame(l))},updateComplete:function(t){this.scheduleUpdate(()=>{setTimeout(t,0)})},addListener:function(t,e,i){t.addEventListener(e,i)},removeListener:function(t,e,i){t.removeEventListener(e,i)},createBindingTarget:function(t){return n.wndw.document.createElement(t)},addChild:function(t,e){t.appendChild(e)},addChildFirst:function(t,i){e.DOMBindingConfig.addChildBefore(t,t.firstChild,i)},addChildBefore:function(t,i,n){i?t.insertBefore(n,i):e.DOMBindingConfig.addChild(t,n)},addChildAfter:function(t,i,n){i?e.DOMBindingConfig.addChildBefore(t,i.nextSibling,n):e.DOMBindingConfig.addChildFirst(t,n)},removeChild:function(t,e){t.removeChild(e)},remove:function(t){t&&t.parentNode&&t.parentNode.removeChild(t)},setText:function(t,e){t.textContent=e},createContainer:()=>n.wndw.document.createDocumentFragment(),addContainerChild(t,e){t.appendChild(e)},addChildContainer(t,e){t.appendChild(e)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=null;n="undefined"!=typeof window?window:new(i(!function(){var t=new Error('Cannot find module "jsdom"');throw t.code="MODULE_NOT_FOUND",t}()).JSDOM)("").window,e.wndw=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(6);e.default=class extends n.Binding{constructor(t,e){super(t,e,null)}Apply(){this.lastValue=this.lastValue||{},this.ApplyRecursive(this.BoundTo,this.lastValue,this.Value),this.lastValue=this.Value}ApplyRecursive(t,e,i){if("object"!=typeof i)throw"Property binding must resolve to an object";for(var n in i){var s=i[n];t[n]&&null!==s&&"object"==typeof s&&s.constructor==={}.constructor?(e[n]=e[n]||{},this.ApplyRecursive(t[n],e[n],s)):(s=s&&s.valueOf(),e[n]!==s&&(t[n]=s))}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(7),s=i(2);var r;!function(t){t[t.Init=0]="Init",t[t.Updating=1]="Updating",t[t.Updated=2]="Updated",t[t.Destroyed=3]="Destroyed"}(r||(r={}));e.Binding=class{constructor(t,e,i){this.boundTo=t,this.status=r.Init,this.setCallback=this.Update.bind(this),this.observableScope=new n.ObjectStoreScope(e),this.observableScope.addListener("set",this.setCallback),this.Init(i),this.Update()}get Value(){return this.observableScope.Value}get BoundTo(){return this.boundTo}Update(){this.status!==r.Destroyed&&(this.status===r.Init?(this.status=r.Updating,this.Apply(),this.status=r.Updated):this.status!==r.Updating&&(this.status=r.Updating,s.BindingConfig.scheduleUpdate(()=>{this.status!==r.Destroyed&&(this.Apply(),this.status=r.Updated)})))}Destroy(){this.observableScope&&this.observableScope.Destroy(),this.status=r.Destroyed}Init(t){}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(8),s=i(9);e.ObjectStoreScope=class extends s.Emitter{constructor(t){super(),this.valueFunction=t,this.trackedEmitters=new Set,this.setCallback=this.SetCallback.bind(this),this.UpdateValue()}get Value(){return this.dirty?(this.UpdateValue(),this.value):this.value}Destroy(){this.removeAllListeners(),this.trackedEmitters.forEach(t=>t.removeListener("set",this.setCallback)),this.trackedEmitters.clear()}UpdateValue(){var t=n.ObjectStore.Watch(()=>{try{this.value=this.valueFunction()}catch(t){console.error(t)}}),e=new Set(t);this.trackedEmitters.forEach(t=>{e.has(t)||t.removeListener("set",this.setCallback)}),e.forEach(t=>t.addListener("set",this.setCallback)),this.trackedEmitters=e,this.dirty=!1}SetCallback(){this.dirty=!0,this.emit("set")}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(9);function s(t){return!t||!(Array.isArray(t)||"object"==typeof t&&{}.constructor===t.constructor)}var r=new n.default;class o extends n.default{constructor(t,e){super(),this.___path=t,this.store=e}}class a{constructor(){}get Value(){return this.getValue()}set Value(t){this.setValue(t)}toString(){var t=this.Value;return t&&t.toString()}valueOf(){var t=this.Value;return t&&t.valueOf()}}e.Value=a;class l extends a{constructor(t,e){super(),this.store=t,this.valuePath=e}getValue(){var t=this.store.GetEmitter(this.valuePath);return r.emit("get",t),this.store.GetPath(this.valuePath)}setValue(t){this.store.SetPath(this.valuePath,t),this.store.GetEmitter(this.valuePath).emit("set")}}class u extends a{constructor(t){super(),this.value=t,this.emitter=new n.default}getValue(){return r.emit("get",this.emitter),this.value}setValue(t){this.value=t,this.emitter.emit("set")}}class h{constructor(t){this.getIdCallback=t,this.emitterMap=new Map,this.emitterMap.set("root",new o("root",this)),this.getterMap=new Map,this.idToPathsMap=new Map}get Root(){return this.EmitGet("root"),this.getterMap.get("root")||this.CreateGetterObject(this.root,"root")}set Root(t){this.Write(null,()=>t)}Get(t){var e=this.idToPathsMap.get(t);if(!e)return null;var i=e.values().next().value;return this.EmitGet(i),this.getterMap.get(i)||this.CreateGetterObject(this.ResolvePropertyPath(i),i)}GetPath(t){var e=this.ResolvePropertyPath(t);return this.EmitGet(t),e}SetPath(t,e){this.WriteTo(t,e)}GetEmitter(t){return this.emitterMap.get(t)}Write(t,e){if("string"!=typeof t||(t=this.Get(t))){var i=t?t.___path:"root",n=this.ResolvePropertyPath(i),s=null,r=null;s="function"==typeof e?e(r=this.CreateCopy(n)):e,this.WriteTo(i,void 0!==s?s:r)}}Push(t,e){var i=t.___path,n=this.ResolvePropertyPath(i),s=[i,n.length].join(".");n.push(null),this.WriteTo(s,e),this.getterMap.get(i).push(this.CreateGetterObject(e,s)),this.EmitSet(i)}WriteTo(t,e,i){var n=this.ResolvePropertyPath(t);n!==e&&(this.AssignPropertyPath(e,t),this.ProcessChanges(t,t,e,n,i))}ProcessChanges(t,e,i,n,r){this.getterMap.delete(e);var o=i&&this.getIdCallback&&this.getIdCallback(i),a=n&&this.getIdCallback&&this.getIdCallback(n);if(a&&a!==o){var l=this.idToPathsMap.get(a);l.delete(e),0===l.size&&this.idToPathsMap.delete(a)}if(!r&&o){var u=this.idToPathsMap.get(o);u?u.has(e)||u.add(e):(u=new Set([e]),this.idToPathsMap.set(o,u)),u.forEach(n=>{n!==e&&0!==n.indexOf(t)&&this.WriteTo(n,i,!0)})}var h=new Set;if(!s(i))for(var d in i){var c=[e,d].join(".");this.ProcessChanges(t,c,i[d],n&&n[d],r),h.add(d)}this.CleanUp(n,h,e),this.EmitSet(e)}CleanUp(t,e,i){if(!s(t)){for(var n in t)if(!e||!e.has(n)){var r=[i,n].join(".");this.emitterMap.delete(r),this.getterMap.delete(r),this.CleanUp(t[n],null,r)}if(!e||0===e.size){var o=this.getIdCallback&&this.getIdCallback(t);if(o){var a=this.idToPathsMap.get(o);a&&(a.delete(i),0===a.size&&this.idToPathsMap.delete(o))}}}}AssignPropertyPath(t,e){var i=e.split("."),n=i[i.length-1],s=i.slice(0,i.length-1);this.ResolvePropertyPath(s.join("."))[n]=t}ResolvePropertyPath(t){return t?t.split(".").reduce((t,e)=>t&&t[e],this):this}CreateGetterObject(t,e){if(s(t))return t;var i=null;if(Array.isArray(t)){i=new Array(t.length);for(var n=0;n<t.length;n++)i[n]=this.CreateGetterObject(t[n],[e,n].join("."))}else for(var r in i=Object.create(null),t)this.CreateGetter(i,e,r);return Object.defineProperty(i,"___path",{value:e,configurable:!1,enumerable:!1,writable:!1}),this.getterMap.set(e,i),i}CreateGetter(t,e,i){var n=[e,i].join(".");Object.defineProperty(t,i,{enumerable:!0,get:()=>{return this.EmitGet(n),this.getterMap.get(n)||this.CreateGetterObject(this.ResolvePropertyPath(n),n)},set:t=>{this.WriteTo(n,t)}})}CreateCopy(t){if(s(t))return t;var e=null;if(Array.isArray(t)){e=new Array(t.length);for(var i=0;i<t.length;i++)e[i]=this.CreateCopy(t[i]);return e}for(var n in e={},t)e[n]=this.CreateCopy(t[n]);return e}EmitSet(t){var e=this.emitterMap.get(t);e||(e=new o(t,this),this.emitterMap.set(t,e)),e.emit("set")}EmitGet(t){var e=this.emitterMap.get(t);e||(e=new o(t,this),this.emitterMap.set(t,e)),r.emit("get",e)}}e.ObjectStore=h,function(t){t.Create=function(e,i){if(s(e))throw"Only arrays and JSON types are supported";var n=new t(i);return n.Root=e,n},t.Watch=function(t){var e=new Set;return r.addListener("get",t=>{e.has(t)||e.add(t)}),t(),r.removeAllListeners(),[...e]},t.Value=function(e){var i=null,n=t.Watch(()=>{i=e()});if(n.length>0){var s=n[n.length-1];if(s instanceof o)return new l(s.store,s.___path)}return new u(i)}}(h=e.ObjectStore||(e.ObjectStore={}))},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.callbackMap={}}addListener(t,e){var i=this.callbackMap[t]||new Set;i.has(e)||i.add(e),this.callbackMap[t]=i}removeListener(t,e){var i=this.callbackMap[t];i&&i.delete(e)}emit(t,...e){var i=this.callbackMap[t];i&&i.forEach(t=>t(...e))}clear(t){var e=this.callbackMap[t];e&&e.clear()}removeAllListeners(){for(var t in this.callbackMap)this.clear(t)}}e.Emitter=i,e.default=i},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(6),s=i(1),r=i(2);e.default=class extends n.Binding{constructor(t,e,i,n){super(t,e,{children:i,key:n})}Destroy(){super.Destroy(),this.DestroyTemplates(this.activeTemplateMap),this.activeTemplateMap=null}Init(t){this.activeTemplateMap=new Map,this.activeKeys=[],this.childrenFunction=t.children,this.keyFunction=t.key}Apply(){var t=this.Value;t?Array.isArray(t)||(t=[t]):t=[];for(var e=new Map,i=[],n=r.BindingConfig.createContainer(),o=null,a=0;a<t.length;a++){var l=this.keyFunction&&this.keyFunction(t[a])||a;i.push(l);var u=this.activeTemplateMap.get(l);if(!u){var h=this.childrenFunction(t[a],a);Array.isArray(h)||(h=[h]),u=h.map(t=>s.Template.Create(t))}e.set(l,u),this.activeTemplateMap.delete(l),a>=this.activeKeys.length?u.forEach(t=>{t.AttachToContainer(n),o=t}):l!==this.activeKeys[a]?u.forEach(t=>{t.AttachAfter(this.BoundTo,o),o=t}):o=u[u.length-1]||o}this.DestroyTemplates(this.activeTemplateMap),this.activeTemplateMap=e,this.activeKeys=i,r.BindingConfig.addChildContainer(this.BoundTo,n)}DestroyTemplates(t){t.forEach(t=>t.forEach(t=>t.Destroy()))}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(6),s=i(2);e.default=class extends n.Binding{constructor(t,e){super(t,e,null)}Apply(){s.BindingConfig.setText(this.BoundTo,this.Value)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(6),s=i(2);e.default=class extends n.Binding{constructor(t,e){super(t,e,null)}Destroy(){for(var t in super.Destroy(),this.boundEvents)s.BindingConfig.removeListener(this.BoundTo,t,this.boundEvents[t])}Apply(){for(var t in this.boundEvents)s.BindingConfig.removeListener(this.BoundTo,t,this.boundEvents[t]);this.boundEvents={};var e=this.Value;for(var t in e)this.boundEvents[t]=e[t],s.BindingConfig.addListener(this.BoundTo,t,e[t])}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(1);e.a=function(t,e){return n.TemplateFunction("a",t,e)},e.ul=function(t,e){return n.TemplateFunction("ul",t,e)},e.li=function(t,e){return n.TemplateFunction("li",t,e)},e.br=function(t,e){return n.TemplateFunction("br",t,e)},e.b=function(t,e){return n.TemplateFunction("b",t,e)},e.div=function(t,e){return n.TemplateFunction("div",t,e)},e.span=function(t,e){return n.TemplateFunction("span",t,e)},e.img=function(t,e){return n.TemplateFunction("img",t,e)},e.video=function(t,e){return n.TemplateFunction("video",t,e)},e.source=function(t,e){return n.TemplateFunction("source",t,e)},e.input=function(t,e){return n.TemplateFunction("input",t,e)},e.option=function(t,e){return n.TemplateFunction("option",t,e)},e.select=function(t,e){return n.TemplateFunction("select",t,e)},e.h1=function(t,e){return n.TemplateFunction("h1",t,e)},e.h2=function(t,e){return n.TemplateFunction("h2",t,e)},e.h3=function(t,e){return n.TemplateFunction("h3",t,e)}}]);